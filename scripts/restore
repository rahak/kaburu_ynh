#!/bin/bash
set -e

source /usr/share/yunohost/helpers

app=$YNH_APP_INSTANCE_NAME
install_dir="/opt/$app"

ynh_print_info "Restoring Kaburu..."

#=================================================
# RESTORE APP DIRECTORY
#=================================================
ynh_restore_file --origin_path="$install_dir"

#=================================================
# RECREATE SYSTEM USER (NO MAILBOX)
#=================================================
ynh_system_user_create --username="$app" --home_dir="$install_dir"
chown -R "$app:$app" "$install_dir"

#=================================================
# RESTORE CRON JOB
#=================================================
ynh_restore_file --origin_path="/etc/cron.d/$app"

#=================================================
# FINAL MESSAGE
#=================================================
domain=$(ynh_app_setting_get "$app" domain)
local_part=$(ynh_app_setting_get "$app" local_part)
email="${local_part}@${domain}"

ynh_print_info "‚úÖ Restore complete"
ynh_print_info "üìß Using existing mailbox: $email"
ynh_print_info "‚è∞ Cron restored"
ynh_print_info "üìÇ App directory restored: $install_dir"
